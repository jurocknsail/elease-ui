"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2098],{52098:(G,L,s)=>{s.r(L),s.d(L,{TabListPageModule:()=>M});var i=s(71734),T=s(96814),c=s(60095),f=s(99351),m=s(15861);class x{constructor(l,r,t,n){this.name=l,this.email=r,this.phone=t,this.leases=n}}var b=s(37649),F=s(29332),e=s(85678),S=s(80586),w=s(40943);function k(o,l){if(1&o&&(e.TgZ(0,"ion-item")(1,"ion-label",19),e._uU(2),e.qZA(),e.TgZ(3,"ion-label",20),e._uU(4),e.ALo(5,"date"),e.qZA()()),2&o){const r=l.$implicit;e.xp6(2),e.Oqu(r.name),e.xp6(2),e.hij("Dernier envoi : ",0!==r.lastSendDate?e.xi3(5,2,r.lastSendDate,"dd/MM/yyyy"):"Jamais","")}}const J=o=>["/leaseholder-details",o];function C(o,l){if(1&o&&(e.TgZ(0,"ion-card",16)(1,"ion-card-header")(2,"ion-card-title"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-card-content")(5,"ion-list",17),e.YNc(6,k,6,5,"ion-item",18),e.qZA()()()),2&o){const r=l.$implicit;e.Q6J("routerLink",e.VKq(3,J,r.objectId)),e.xp6(3),e.Oqu(r.name),e.xp6(3),e.Q6J("ngForOf",r.leases)}}function N(o,l){if(1&o){const r=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",8)(3,"ion-button",21),e.NdJ("click",function(){e.CHM(r);const n=e.oxw();return e.KtG(n.cancel())}),e._uU(4,"Annuler"),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6,"Ajouter un Locataire"),e.qZA(),e.TgZ(7,"ion-buttons",22)(8,"ion-button",23),e.NdJ("click",function(){e.CHM(r);const n=e.oxw();return e.KtG(n.confirm())}),e._uU(9,"Ajouter"),e.qZA()()()(),e.TgZ(10,"ion-content",1)(11,"form",24),e.NdJ("keydown.enter",function(n){return n.preventDefault()})("ngSubmit",function(){e.CHM(r);const n=e.oxw();return e.KtG(n.onSubmit())}),e.TgZ(12,"ion-list")(13,"ion-item",25),e._UZ(14,"ion-input",26),e.qZA(),e.TgZ(15,"ion-item",25),e._UZ(16,"ion-input",27),e.qZA(),e.TgZ(17,"ion-item",25),e._UZ(18,"ion-input",28),e.qZA()()()()}if(2&o){const r=e.oxw();e.xp6(8),e.ekj("button-disabled",!r.newLeaseHolderForm.valid),e.Q6J("strong",!0),e.xp6(3),e.Q6J("formGroup",r.newLeaseHolderForm)}}const R=[{path:"",component:(()=>{var o;class l{constructor(t,n,a,u,d,p,g){this.parseService=t,this.inseeService=n,this.formBuilder=a,this.router=u,this.menuController=d,this.loadingController=p,this.toastController=g,this.message="This modal example uses triggers to automatically open a modal when the button is clicked.",this.leaseholders=[]}ngOnInit(){var t=this;return(0,m.Z)(function*(){yield t.parseService.fetchLeaseholders(),t.leaseholders=t.parseService.getLeaseholders();try{t.lastIRL=yield t.inseeService.getIRLData(),t.lastILAT=yield t.inseeService.getILATData()}catch(n){console.error("Error loading INSEE data",n)}t.newLeaseHolderForm=t.formBuilder.group({name:["",[c.kI.required,c.kI.maxLength(30)]],phone:["",[c.kI.required,(0,F.x)()]],email:["",[c.kI.required,c.kI.email]]})})()}logout(){var t=this;return(0,m.Z)(function*(){t.parseService.clearData();const n=yield b.User.logOut();yield t.menuController.close(),yield t.router.navigate(["/login"]),console.log("Logged out",n)})()}export(){var t=this;return(0,m.Z)(function*(){t.downloadFile(t.parseService.getLeaseholders()),yield t.menuController.close()})()}downloadFile(t){var n;const a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),u=URL.createObjectURL(a),d=document.createElement("a");d.href=u,d.download="elease-backup-"+(null===(n=b.User.current())||void 0===n?void 0:n.getUsername())+"-"+(new Date).toISOString().split("T")[0].trim()+".json",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(u)}triggerFileInput(){var t=this;return(0,m.Z)(function*(){yield t.menuController.close(),document.getElementById("fileInput").click()})()}handleFileInput(t){var n=this;return(0,m.Z)(function*(){const a=yield n.loadingController.create({message:"Importation des donn\xe9es ..."});yield a.present();const u=t.target;if(u.files&&u.files[0]){const d=u.files[0],p=new FileReader;p.onload=g=>{try{if(null!=g.target){let h;h=JSON.parse(g.target.result),console.log("Imported JSON:",h);let Z=[];h.forEach(y=>{const E=new Promise(function(){var Y=(0,m.Z)(function*(P){let U=[],A=[];y.leases.forEach(_=>{const j=new Promise(function(){var D=(0,m.Z)(function*(I){n.parseService.createLease(_,n.lastILAT,n.lastIRL).then(v=>{U.push(v),I()}).catch(v=>{console.log("ERROR creating lease : "+v),a.dismiss(),n.createToast("Une erreur est survenue, recommence !",3e3,"middle","danger","warning")})});return function(I){return D.apply(this,arguments)}}());A.push(j)}),Promise.all(A).then(()=>{n.parseService.createLeaseholderAndLeases(y,U).then(()=>{P()}).catch(_=>{console.log("ERROR creating lease : "+_),a.dismiss(),n.createToast("Une erreur est survenue, recommence !",3e3,"middle","danger","warning")})})});return function(P){return Y.apply(this,arguments)}}());Z.push(E)}),Promise.all(Z).then(()=>{console.log("Import Leaseholders terminated."),a.dismiss(),n.createToast("Donn\xe9es import\xe9es avec succ\xe8s ! \u{1f60a}",2e3,"top","success","send")})}}catch(h){console.error("Error parsing JSON:",h),a.dismiss(),n.createToast("Une erreur est survenue, recommence !",3e3,"middle","danger","warning")}},p.readAsText(d)}else console.log("File picker unexpected error"),a.dismiss(),n.createToast("Une erreur est survenue, recommence !",3e3,"middle","danger","warning");u.value=""})()}cancel(){var t;null===(t=this.modal)||void 0===t||t.dismiss(null,"cancel")}confirm(){var t;null===(t=this.modal)||void 0===t||t.dismiss(this.name,"confirm")}onSubmit(){if(this.newLeaseHolderForm.valid){const n=new x(this.newLeaseHolderForm.controls.name.value,this.newLeaseHolderForm.controls.email.value,this.newLeaseHolderForm.controls.phone.value,[]);this.parseService.createLeaseholder(n)}}onWillDismiss(t){"confirm"===t.detail.role&&(this.message=`Hello, ${t.detail.data}!`)}createToast(t,n,a,u,d){this.toastController.create({message:t,duration:n,position:a,color:u,icon:d}).then(g=>{g.present()})}}return(o=l).\u0275fac=function(t){return new(t||o)(e.Y36(S.X),e.Y36(w.g),e.Y36(c.qu),e.Y36(f.F0),e.Y36(i._q),e.Y36(i.HT),e.Y36(i.yF))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-list"]],viewQuery:function(t,n){if(1&t&&e.Gf(i.ki,5),2&t){let a;e.iGM(a=e.CRH())&&(n.modal=a.first)}},decls:33,vars:3,consts:[["contentId","main-content"],[1,"ion-padding"],["type","file","id","fileInput",2,"display","none",3,"change"],["button","","detail","false",3,"click"],["aria-hidden","true","name","cloud-download","slot","start","color","success"],["aria-hidden","true","name","cloud-upload","slot","start","color","success"],["aria-hidden","true","name","log-out","slot","start","color","danger"],[3,"translucent"],["slot","start"],["color","success"],["id","main-content",3,"fullscreen"],["color","light",3,"routerLink",4,"ngFor","ngForOf"],["id","open-modal","color","success","button","true",2,"text-align","center"],["color","light","shape","round","fill","outline","size","large","disabled","true"],["slot","icon-only","name","add"],["trigger","open-modal"],["color","light",3,"routerLink"],["color","light"],[4,"ngFor","ngForOf"],[1,"left-label"],[1,"right-label"],[3,"click"],["slot","end"],["type","submit","form","newLeaseHolderForm",3,"strong","click"],["id","newLeaseHolderForm",3,"formGroup","keydown.enter","ngSubmit"],["lines","none"],["labelPlacement","floating","label","Nom","formControlName","name","type","text","errorText","Nom invalide !"],["labelPlacement","floating","label","T\xe9l\xe9phone","formControlName","phone","type","tel","errorText","Num\xe9ro invalide !"],["labelPlacement","floating","label","Email","formControlName","email","type","email","errorText","Email invalide !"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-menu",0)(1,"ion-header")(2,"ion-toolbar")(3,"ion-title"),e._uU(4,"Menu"),e.qZA()()(),e.TgZ(5,"ion-content",1)(6,"input",2),e.NdJ("change",function(u){return n.handleFileInput(u)}),e.qZA(),e.TgZ(7,"ion-list")(8,"ion-item",3),e.NdJ("click",function(){return n.export()}),e._UZ(9,"ion-icon",4),e.TgZ(10,"ion-label"),e._uU(11,"Sauvegarder"),e.qZA()(),e.TgZ(12,"ion-item",3),e.NdJ("click",function(){return n.triggerFileInput()}),e._UZ(13,"ion-icon",5),e.TgZ(14,"ion-label"),e._uU(15,"Importer"),e.qZA()(),e.TgZ(16,"ion-item",3),e.NdJ("click",function(){return n.logout()}),e._UZ(17,"ion-icon",6),e.TgZ(18,"ion-label"),e._uU(19,"Se deconnecter"),e.qZA()()()()(),e.TgZ(20,"ion-header",7)(21,"ion-toolbar")(22,"ion-buttons",8),e._UZ(23,"ion-menu-button",9),e.qZA(),e.TgZ(24,"ion-title"),e._uU(25," Locataires "),e.qZA()()(),e.TgZ(26,"ion-content",10),e.YNc(27,C,7,5,"ion-card",11),e.TgZ(28,"ion-card",12)(29,"ion-button",13),e._UZ(30,"ion-icon",14),e.qZA()(),e.TgZ(31,"ion-modal",15),e.YNc(32,N,19,4,"ng-template"),e.qZA()()),2&t&&(e.xp6(20),e.Q6J("translucent",!0),e.xp6(6),e.Q6J("fullscreen",!0),e.xp6(1),e.Q6J("ngForOf",n.leaseholders))},dependencies:[i.YG,i.Sm,i.PM,i.FN,i.Zi,i.Dq,i.W2,i.Gu,i.gu,i.pK,i.Ie,i.Q$,i.q_,i.z0,i.fG,i.wd,i.sr,i.ki,i.j9,i.YI,T.sg,c._Y,c.JJ,c.JL,c.sg,c.u,f.rH,T.uU],styles:[".left-label[_ngcontent-%COMP%]{text-align:left;width:50%}.right-label[_ngcontent-%COMP%]{text-align:right;width:50%}"]}),l})(),canActivate:[s(8407).a]}];let q=(()=>{var o;class l{}return(o=l).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[f.Bz.forChild(R),f.Bz]}),l})(),M=(()=>{var o;class l{}return(o=l).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[i.Pc,T.ez,c.u5,c.UX,q]}),l})()}}]);