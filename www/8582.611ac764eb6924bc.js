"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8582],{68582:(E,L,u)=>{u.r(L),u.d(L,{TabListPageModule:()=>O});var i=u(71734),T=u(96814),c=u(60095),h=u(99351),m=u(15861);class A{constructor(l,r,t,n){this.name=l,this.email=r,this.phone=t,this.leases=n}}var Z=u(37649),e=u(85678),k=u(29180);function S(o,l){if(1&o&&(e.TgZ(0,"ion-item")(1,"ion-label",19),e._uU(2),e.qZA(),e.TgZ(3,"ion-label",20),e._uU(4),e.ALo(5,"date"),e.qZA()()),2&o){const r=l.$implicit;e.xp6(2),e.Oqu(r.name),e.xp6(2),e.hij("Dernier envoi : ",0!==r.lastSendDate?e.xi3(5,2,r.lastSendDate,"dd/MM/yyyy"):"Jamais","")}}const x=o=>["/leaseholder-details",o];function J(o,l){if(1&o&&(e.TgZ(0,"ion-card",16)(1,"ion-card-header")(2,"ion-card-title"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-card-content")(5,"ion-list",17),e.YNc(6,S,6,5,"ion-item",18),e.qZA()()()),2&o){const r=l.$implicit;e.Q6J("routerLink",e.VKq(3,x,r.objectId)),e.xp6(3),e.Oqu(r.name),e.xp6(3),e.Q6J("ngForOf",r.leases)}}function C(o,l){if(1&o){const r=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",8)(3,"ion-button",21),e.NdJ("click",function(){e.CHM(r);const n=e.oxw();return e.KtG(n.cancel())}),e._uU(4,"Annuler"),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6,"Ajouter un Locataire"),e.qZA(),e.TgZ(7,"ion-buttons",22)(8,"ion-button",23),e.NdJ("click",function(){e.CHM(r);const n=e.oxw();return e.KtG(n.confirm())}),e._uU(9,"Ajouter"),e.qZA()()()(),e.TgZ(10,"ion-content",1)(11,"form",24),e.NdJ("keydown.enter",function(n){return n.preventDefault()})("ngSubmit",function(){e.CHM(r);const n=e.oxw();return e.KtG(n.onSubmit())}),e.TgZ(12,"ion-list")(13,"ion-item"),e._UZ(14,"ion-input",25),e.qZA(),e.TgZ(15,"ion-item"),e._UZ(16,"ion-input",26),e.qZA(),e.TgZ(17,"ion-item"),e._UZ(18,"ion-input",27),e.qZA()()()()}if(2&o){const r=e.oxw();e.xp6(8),e.ekj("button-disabled",!r.newLeaseHolderForm.valid),e.Q6J("strong",!0),e.xp6(3),e.Q6J("formGroup",r.newLeaseHolderForm)}}const q=[{path:"",component:(()=>{var o;class l{constructor(t,n,a,s,d,g){this.parseService=t,this.formBuilder=n,this.router=a,this.menuController=s,this.loadingController=d,this.toastController=g,this.message="This modal example uses triggers to automatically open a modal when the button is clicked.",this.leaseholders=[]}ngOnInit(){var t=this;return(0,m.Z)(function*(){yield t.parseService.fetchLeaseholders(),t.leaseholders=t.parseService.getLeaseholders(),t.newLeaseHolderForm=t.formBuilder.group({name:["",[c.kI.required]],phone:["",[c.kI.required]],email:["",[c.kI.required,c.kI.email]]})})()}logout(){var t=this;return(0,m.Z)(function*(){t.parseService.clearData();const n=yield Z.User.logOut();yield t.menuController.close(),yield t.router.navigate(["/login"]),console.log("Logged out",n)})()}export(){var t=this;return(0,m.Z)(function*(){t.downloadFile(t.parseService.getLeaseholders()),yield t.menuController.close()})()}downloadFile(t){var n;const a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(a),d=document.createElement("a");d.href=s,d.download="elease-backup-"+(null===(n=Z.User.current())||void 0===n?void 0:n.getUsername())+"-"+(new Date).toLocaleString().replace(" ","-").trim(),document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(s)}triggerFileInput(){var t=this;return(0,m.Z)(function*(){yield t.menuController.close(),document.getElementById("fileInput").click()})()}handleFileInput(t){var n=this;return(0,m.Z)(function*(){const a=yield n.loadingController.create({message:"Importation des donn\xe9es ..."});yield a.present();const s=t.target;if(s.files&&s.files[0]){const d=s.files[0],g=new FileReader;g.onload=f=>{try{if(null!=f.target){let p=[];p=JSON.parse(f.target.result),console.log("Imported JSON:",p);let v=[];p.forEach(y=>{const M=new Promise(function(){var R=(0,m.Z)(function*(P){let U=[],w=[];y.leases.forEach(_=>{const j=new Promise(function(){var Y=(0,m.Z)(function*(F){n.parseService.createLease(_).then(b=>{U.push(b),F()}).catch(b=>{console.log("ERROR creating lease : "+b),a.dismiss(),n.createToast("Une erreur est survenue, recommence !",3e3,"middle","danger","warning")})});return function(F){return Y.apply(this,arguments)}}());w.push(j)}),Promise.all(w).then(()=>{n.parseService.createLeaseholderAndLeases(y,U).then(_=>{P()}).catch(_=>{console.log("ERROR creating lease : "+_),a.dismiss(),n.createToast("Une erreur est survenue, recommence !",3e3,"middle","danger","warning")})})});return function(P){return R.apply(this,arguments)}}());v.push(M)}),Promise.all(v).then(()=>{console.log("Import Leaseholders terminated."),a.dismiss(),n.createToast("Donn\xe9es import\xe9es avec succ\xe8s ! \u{1f60a}",2e3,"top","success","send")})}}catch(p){console.error("Error parsing JSON:",p),a.dismiss(),n.createToast("Une erreur est survenue, recommence !",3e3,"middle","danger","warning")}},g.readAsText(d)}else console.log("File picker unexpected error"),a.dismiss(),n.createToast("Une erreur est survenue, recommence !",3e3,"middle","danger","warning");s.value=""})()}cancel(){var t;null===(t=this.modal)||void 0===t||t.dismiss(null,"cancel")}confirm(){var t;null===(t=this.modal)||void 0===t||t.dismiss(this.name,"confirm")}onSubmit(){if(this.newLeaseHolderForm.valid){const n=new A(this.newLeaseHolderForm.controls.name.value,this.newLeaseHolderForm.controls.email.value,this.newLeaseHolderForm.controls.phone.value,[]);this.parseService.createLeaseholder(n)}}onWillDismiss(t){"confirm"===t.detail.role&&(this.message=`Hello, ${t.detail.data}!`)}createToast(t,n,a,s,d){this.toastController.create({message:t,duration:n,position:a,color:s,icon:d}).then(f=>{f.present()})}}return(o=l).\u0275fac=function(t){return new(t||o)(e.Y36(k.X),e.Y36(c.qu),e.Y36(h.F0),e.Y36(i._q),e.Y36(i.HT),e.Y36(i.yF))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab-list"]],viewQuery:function(t,n){if(1&t&&e.Gf(i.ki,5),2&t){let a;e.iGM(a=e.CRH())&&(n.modal=a.first)}},decls:33,vars:3,consts:[["contentId","main-content"],[1,"ion-padding"],["type","file","id","fileInput",2,"display","none",3,"change"],["button","","detail","false",3,"click"],["aria-hidden","true","name","cloud-download","slot","start","color","success"],["aria-hidden","true","name","cloud-upload","slot","start","color","success"],["aria-hidden","true","name","log-out","slot","start","color","danger"],[3,"translucent"],["slot","start"],["color","success"],["id","main-content",3,"fullscreen"],["color","light",3,"routerLink",4,"ngFor","ngForOf"],["id","open-modal","color","success","button","true",2,"text-align","center"],["color","light","shape","round","fill","outline","size","large","disabled","true"],["slot","icon-only","name","add"],["trigger","open-modal"],["color","light",3,"routerLink"],["color","light"],[4,"ngFor","ngForOf"],[1,"left-label"],[1,"right-label"],[3,"click"],["slot","end"],["type","submit","form","newLeaseHolderForm",3,"strong","click"],["id","newLeaseHolderForm",3,"formGroup","keydown.enter","ngSubmit"],["labelPlacement","floating","label","Nom","formControlName","name","type","string"],["labelPlacement","floating","label","T\xe9l\xe9phone","formControlName","phone","type","string"],["labelPlacement","floating","label","Email","formControlName","email","type","email"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-menu",0)(1,"ion-header")(2,"ion-toolbar")(3,"ion-title"),e._uU(4,"Menu"),e.qZA()()(),e.TgZ(5,"ion-content",1)(6,"input",2),e.NdJ("change",function(s){return n.handleFileInput(s)}),e.qZA(),e.TgZ(7,"ion-list")(8,"ion-item",3),e.NdJ("click",function(){return n.export()}),e._UZ(9,"ion-icon",4),e.TgZ(10,"ion-label"),e._uU(11,"Sauvegarder"),e.qZA()(),e.TgZ(12,"ion-item",3),e.NdJ("click",function(){return n.triggerFileInput()}),e._UZ(13,"ion-icon",5),e.TgZ(14,"ion-label"),e._uU(15,"Importer"),e.qZA()(),e.TgZ(16,"ion-item",3),e.NdJ("click",function(){return n.logout()}),e._UZ(17,"ion-icon",6),e.TgZ(18,"ion-label"),e._uU(19,"Se deconnecter"),e.qZA()()()()(),e.TgZ(20,"ion-header",7)(21,"ion-toolbar")(22,"ion-buttons",8),e._UZ(23,"ion-menu-button",9),e.qZA(),e.TgZ(24,"ion-title"),e._uU(25," Locataires "),e.qZA()()(),e.TgZ(26,"ion-content",10),e.YNc(27,J,7,5,"ion-card",11),e.TgZ(28,"ion-card",12)(29,"ion-button",13),e._UZ(30,"ion-icon",14),e.qZA()(),e.TgZ(31,"ion-modal",15),e.YNc(32,C,19,4,"ng-template"),e.qZA()()),2&t&&(e.xp6(20),e.Q6J("translucent",!0),e.xp6(6),e.Q6J("fullscreen",!0),e.xp6(1),e.Q6J("ngForOf",n.leaseholders))},dependencies:[i.YG,i.Sm,i.PM,i.FN,i.Zi,i.Dq,i.W2,i.Gu,i.gu,i.pK,i.Ie,i.Q$,i.q_,i.z0,i.fG,i.wd,i.sr,i.ki,i.j9,i.YI,T.sg,c._Y,c.JJ,c.JL,c.sg,c.u,h.rH,T.uU],styles:[".left-label[_ngcontent-%COMP%]{text-align:left;width:50%}.right-label[_ngcontent-%COMP%]{text-align:right;width:50%}"]}),l})(),canActivate:[u(8407).a]}];let N=(()=>{var o;class l{}return(o=l).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[h.Bz.forChild(q),h.Bz]}),l})(),O=(()=>{var o;class l{}return(o=l).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[i.Pc,T.ez,c.u5,c.UX,N]}),l})()}}]);